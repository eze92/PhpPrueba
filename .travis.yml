language: php
php:
 - 7.3
env:
  global:
    - DISPLAY=:99.0
    - BROWSER_NAME="turismonacionaleinternacional"
    - SELENIUM_SERVER="https://selenium-release.storage.googleapis.com/3.14/selenium-server-standalone-3.14.0.jar" # Latest version including HtmlUnit
services:
 - mysql
 - xvfb
install:  
 - "composer install" 
script: phpunit --configuration phpunit.xml --coverage-text
matrix:
 allow_failures:
   - php: 7.3
   - name: 'Sauce Labs, Chrome 79, OSS protocol'
     env: BROWSER_NAME="chrome" VERSION="79.0" PLATFORM="Windows 10" 
before_script:
    - wget https://chromedriver.storage.googleapis.com/79.0.3945.36/chromedriver_win32.zip;
    - unzip chromedriver_win32.zip;
    - export CHROMEDRIVER_PATH=$PWD/chromedriver/chromedriver; 
    - "wget https://selenium-release.storage.googleapis.com/3.14/selenium-server-standalone-3.14.0.jar"
    -  java -Dwebdriver.chrome.driver="$PWD/chromedriver/chromedriver" -jar  selenium-server-standalone-3.14.0.jar -enablePassThrough false -log ./logs/selenium.log &
    - php -S localhost:4444 -t tests/functional/web/ &>>./logs/php-server.log &
    - until $(echo | nc localhost 4444); do sleep 1; echo waiting for PHP server on port 4444...; done; echo "PHP server started"
    
    
